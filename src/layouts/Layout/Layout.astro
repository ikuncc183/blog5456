---
// å…³é”®ï¼šä¸å†éœ€è¦ä» props è·å– headings
const { title, keywords, description, pagecover, activeNav, Home } = Astro.props;
// å¯¼å…¥ç½‘ç«™å…¨å±€é…ç½®
import SITE_INFO from "@/config";
const { GoogleAds, Theme, HomeBanner } = SITE_INFO;
const { ad_Client, asideAD_Slot, articleAD_Slot } = GoogleAds;
// å¯¼å…¥å„ä¸ªç»„ä»¶
import Head from "@/components/Head/Head.astro";
import Header from "@/components/Header/Header.astro";
import MainHeader from "@/components/MainHeader/MainHeader.astro";
import Aside from "@/components/Aside/Aside.astro";
import Footer from "@/components/Footer/Footer.astro";
import BackTop from "@/components/BackTop/BackTop.astro";
import MobileSidebar from "@/components/MobileSidebar/MobileSidebar.astro";
import SakuraEffect from "@/components/SakuraEffect.astro";
// å¯¼å…¥æ–°çš„ç›®å½•ç®¡ç†å™¨
import TocManager from "@/components/TocManager.astro";
// å¼•å…¥æ ·å¼
import "@/styles/Reset.less";
import "@/styles/Base.less";
import "./Layout.less";
---

<html lang="zh-CN">
	<Head {title} {keywords} {description} PageCover={pagecover}>
		<!-- è°·æ­Œå¹¿å‘ŠJSåŠ è½½é¡¹ -->
		{ad_Client && (asideAD_Slot || articleAD_Slot) && <script is:inline async src={`https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=${ad_Client}`} crossorigin="anonymous" />}
		<!-- å½©æ——ğŸˆç‰¹æ•ˆè„šæœ¬ -->
		<script is:inline src="/assets/js/vhCaiqi.js" defer></script>
		<!-- å†…è”æ ·å¼ -->
		<Fragment
			set:html={`<style>:root {${Object.entries(Theme)
				.map(([key, value]) => `${key}:${value};`)
				.join("")}--vh-main-header-height:${Home ? HomeBanner.HomeHeight : HomeBanner.PageHeight};--vh-home-banner:${HomeBanner.background}}</style>`}
		/>
	</Head>
	<body>
		<MobileSidebar />
		<Header {activeNav} />
		<main class="main">
			{HomeBanner.enable && <MainHeader />}
			<section class="main-inner" style={`padding-top:${HomeBanner.enable ? "0.88rem" : "calc(66px + 0.68rem)"}`}>
				<section class="main-inner-content">
					<slot />
				</section>
                {/* å…³é”®ï¼šAside ç»„ä»¶ä¸å†éœ€è¦ä»»ä½• props */}
				<Aside />
			</section>
			<BackTop />
		</main>
		<Footer />
		<SakuraEffect />
		
		{/* å…³é”®ï¼šåœ¨é¡µé¢åº•éƒ¨æ·»åŠ ç›®å½•ç®¡ç†å™¨ */}
		<TocManager />

		<script>
			import InitFn from "@/scripts/Init";
			InitFn();
		</script>

        {/* --- æ–°å¢ï¼šä¿®å¤ä¾§è¾¹æ æ»‘åŠ¨æ•ˆæœçš„è„šæœ¬ --- */}
        <script>
          // è¿™ä¸ªå‡½æ•°ç”¨äºåˆå§‹åŒ–ä¾§è¾¹æ æŒ‰é’®çš„åŠŸèƒ½
          function initializeSidebarToggle() {
            const toggleBtn = document.getElementById('aside-toggle-btn');
            const sidebar = document.querySelector('.vh-aside');
            const overlay = document.getElementById('aside-overlay');

            // å¦‚æœé¡µé¢ä¸Šæ²¡æœ‰è¿™äº›å…ƒç´ ï¼Œå°±ä»€ä¹ˆä¹Ÿä¸åš
            if (!toggleBtn || !sidebar || !overlay) {
              return;
            }

            // æ£€æŸ¥æŒ‰é’®æ˜¯å¦å·²ç»ç»‘å®šè¿‡äº‹ä»¶ï¼Œé˜²æ­¢é‡å¤ç»‘å®š
            if (toggleBtn.dataset.listenerAttached) {
                return;
            }

            const closeSidebar = () => {
              sidebar.classList.remove('is-open');
              overlay.classList.remove('is-visible');
            };

            const openSidebar = () => {
              sidebar.classList.add('is-open');
              overlay.classList.add('is-visible');
            };

            // ä¸ºæŒ‰é’®æ·»åŠ ç‚¹å‡»äº‹ä»¶
            toggleBtn.addEventListener('click', (e) => {
              e.stopPropagation();
              if (sidebar.classList.contains('is-open')) {
                closeSidebar();
              } else {
                openSidebar();
              }
            });

            // ä¸ºé®ç½©å±‚æ·»åŠ ç‚¹å‡»äº‹ä»¶ï¼Œç”¨äºå…³é—­ä¾§è¾¹æ 
            overlay.addEventListener('click', closeSidebar);
            
            // ç»™æŒ‰é’®åšä¸€ä¸ªæ ‡è®°ï¼Œè¡¨ç¤ºå·²ç»ç»‘å®šè¿‡äº‹ä»¶äº†
            toggleBtn.dataset.listenerAttached = 'true';
          }

          // é¡µé¢é¦–æ¬¡åŠ è½½æ—¶ï¼Œè¿è¡Œä¸€æ¬¡åˆå§‹åŒ–å‡½æ•°
          document.addEventListener('DOMContentLoaded', initializeSidebarToggle);

          // åœ¨Astroçš„é¡µé¢åˆ‡æ¢ï¼ˆè§†å›¾è½¬æ¢ï¼‰å®Œæˆåï¼Œå†æ¬¡è¿è¡Œåˆå§‹åŒ–å‡½æ•°
          // è¿™æ˜¯ç¡®ä¿æŒ‰é’®åœ¨ç«™å†…è·³è½¬åä¾ç„¶æœ‰æ•ˆçš„å…³é”®
          document.addEventListener('astro:after-swap', initializeSidebarToggle);
        </script>
	</body>
</html>
