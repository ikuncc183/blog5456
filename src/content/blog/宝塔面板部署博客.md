---
title: "å®å¡”é¢æ¿éƒ¨ç½²åšå®¢"
categories: åšå®¢éƒ¨ç½²
tags:
  - å®å¡”
  - åšå®¢
  - æœåŠ¡å™¨
id: "f3cb9148798593b0"
date: 2025-06-23 18:59:20
cover: "https://zycs-img-c5u.pages.dev/v2/s2AI2j0.png"
---

:::note
ä½¿ç”¨å®å¡”é¢æ¿éƒ¨ç½²åšå®¢
:::

# Astro åšå®¢éƒ¨ç½²åˆ°å®å¡”æœåŠ¡å™¨ + GitHub Actions è‡ªåŠ¨éƒ¨ç½²æŒ‡å—

## ğŸ› ï¸ ä¸€ã€é¡¹ç›®èƒŒæ™¯

æœ¬é¡¹ç›®ä½¿ç”¨ [Astro](https://astro.build/) ç”Ÿæˆé™æ€åšå®¢ï¼Œæ‰˜ç®¡äº GitHubï¼Œå¹¶é€šè¿‡ GitHub Actions è‡ªåŠ¨éƒ¨ç½²åˆ°è‡ªè´­ Linux æœåŠ¡å™¨ï¼ˆå·²å®‰è£…å®å¡”é¢æ¿ï¼‰ã€‚

---

## ğŸš§ äºŒã€å‡†å¤‡å·¥ä½œ

### âœ… ç¯å¢ƒè¦æ±‚

* Linux æœåŠ¡å™¨ï¼ˆå¦‚ Ubuntu 24.04ï¼Œå…¶ä»–ä¹Ÿå¯ä»¥2H2Gï¼‰
* å®å¡”é¢æ¿ï¼ˆå¯é€‰ä½†æ¨èï¼‰
* Astro åšå®¢ä»£ç 
* åŸŸåå¦‚ `blog.uf4.top`
* GitHub ä»“åº“ + Actions æƒé™

### ğŸ”§ å®‰è£…å®å¡”

```bash
# å®˜æ–¹å®‰è£…è„šæœ¬ï¼ˆä»¥ Ubuntu ä¸ºä¾‹ï¼‰(å®å¡”å®˜ç½‘ä¹Ÿæœ‰ï¼Œç›´æ¥æ‰¾)
wget -O install.sh http://download.bt.cn/install/install-ubuntu_6.0.sh && sudo bash install.sh
```

è®¿é—®é¢æ¿åœ°å€ï¼Œè®¾ç½®è´¦æˆ·å¯†ç ã€‚

---

## ğŸ” ä¸‰ã€é…ç½® SSH å¯†é’¥ï¼ˆç”¨äº CI è‡ªåŠ¨éƒ¨ç½²ï¼‰
1. ç”Ÿæˆ SSH å¯†é’¥å¯¹
```bash
#ã€€ç”Ÿæˆ SSH å¯†é’¥å¯¹
ssh-keygen -t rsa -b 4096 -C "github-ci" -f ~/.ssh/id_rsa_ci
# id_rsa_ciï¼šç§é’¥ï¼ˆä½ è¦ä¿å­˜åœ¨ GitHub Actions çš„ Secretsï¼‰
# id_rsa_ci.pubï¼šå…¬é’¥ï¼ˆä½ è¦æ”¾åˆ°ä½ æœåŠ¡å™¨çš„ ~/.ssh/authorized_keys ä¸­ï¼‰
```
```bash
# åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼š
mkdir -p ~/.ssh
cat id_rsa_ci.pub >> ~/.ssh/authorized_keys
chmod 600 ~/.ssh/authorized_keys
```
2. é…ç½® GitHub Secrets:

    åœ¨ä½ çš„åšå®¢ GitHub ä»“åº“ï¼š

    `Settings` â†’ `Secrets` â†’ `Actions` â†’ `New repository secret`ï¼š
    
    `SSH_PRIVATE_KEY`ï¼šå†…å®¹æ˜¯ä½ ç”Ÿæˆçš„ id_rsa_ci
    
    `SSH_USER`ï¼šæœåŠ¡å™¨ç”¨æˆ·åï¼ˆå¦‚ ubuntuï¼‰
    
    `SSH_HOST`ï¼šæœåŠ¡å™¨å…¬ç½‘ IP æˆ–åŸŸå
    
    `SSH_TARGET_DIR`ï¼šæ¯”å¦‚ /var/www/blog.uf4.top


å»ºè®®å°†æœåŠ¡å™¨é»˜è®¤ `22` ç«¯å£æ›´æ”¹ä¸ºå…¶ä»–ç«¯å£å¦‚ `22022`ï¼Œå¹¶å¼€å¯é˜²ç«å¢™ç›¸åº”ç«¯å£ã€‚

---

## ğŸ“¦ å››ã€å®å¡”åˆ›å»ºé™æ€ç«™ç‚¹

1. æ·»åŠ ç½‘ç«™ï¼š`blog.uf4.top`
2. ç½‘ç«™ç›®å½•ï¼š`/www/wwwroot/blog.uf4.top`(è‡ªå·±é€‰ä¸ªç›®å½•å°±è¡Œï¼Œä¸CIä»“åº“ç›®å½•ä¸€è‡´)
3. å®‰è£… Nginxï¼Œä¿®æ”¹é…ç½®ï¼š

```nginx
location / {
    try_files $uri $uri/ /index.html;
}
```

4. å¯é€‰ï¼šä½¿ç”¨ Let's Encrypt å…è´¹ç”³è¯· HTTPS

---

## ğŸ¤– äº”ã€GitHub Actions è‡ªåŠ¨éƒ¨ç½²é…ç½®

`.github/workflows/deploy.yml`ï¼š

```yaml
name: Build & Deploy Astro Blog to Linux Server

on:
  push:
    branches: [main]  # å¦‚æœä½ ç”¨çš„æ˜¯ master åˆ†æ”¯è¯·æ”¹ä¸º master

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Install dependencies
        run: npm ci

      - name: Build Astro site
        run: npm run build

      - name: Deploy via rsync over SSH
        uses: burnett01/rsync-deployments@7.0.2
        with:
          switches: -avz --delete
          path: dist/
          remote_path: ${{ secrets.SSH_TARGET_DIR }}
          remote_host: ${{ secrets.SSH_HOST }}
          remote_user: ${{ secrets.SSH_USER }}
          remote_key: ${{ secrets.SSH_PRIVATE_KEY }}
          remote_port: 22022  #ã€€è¿™ä¸ªæ˜¯è‡ªå·±é€‰çš„ç«¯å£

```

---

## ğŸ•³ï¸ å…­ã€å¸¸è§å‘ç‚¹æ€»ç»“

### 1. **è‡ªåŠ¨è·³è½¬åˆ° cn.blog.uf4.topï¼Ÿ**

* åŸå› ï¼šCloudflare æœ‰æ—§è·³è½¬è§„åˆ™æˆ–ä½ å¼€å¯äº†ä»£ç†
* è§£å†³ï¼šå…³é—­ Cloudflare ä»£ç†ï¼ˆå˜æˆç°è‰²å°äº‘ï¼‰ï¼Œåˆ é™¤æ‰€æœ‰ Page Rules

### 2. **SSH è¿æ¥å¤±è´¥ / æƒé™æ‹’ç»ï¼Ÿ**

* åŸå› ï¼šå¯†é’¥æœªæ·»åŠ ã€ç«¯å£æœªå¼€æ”¾
* è§£å†³ï¼šæ£€æŸ¥ `authorized_keys`ï¼Œä½¿ç”¨ `chmod 600` æƒé™ï¼Œå¼€æ”¾ 22022 ç«¯å£ï¼Œæˆ–è€…æ£€æŸ¥ä¸€ä¸‹é¢æ¿çš„é˜²ç«å¢™è®¾ç½®

### 3. **ç½‘é¡µæ— é™åˆ·æ–° / ç©ºç™½ï¼Ÿ**

* åŸå› ï¼šNginx ç¼ºå¤± `try_files` é…ç½®æˆ–ä¸Šä¼ è·¯å¾„é”™è¯¯
* è§£å†³ï¼šç¡®è®¤ `dist/` ä¸­å†…å®¹è¢«æ­£ç¡®ä¸Šä¼ ï¼Œå¹¶åŠ ä¸Š `try_files` è§„åˆ™

### 4. **DNS å·²è§£æä½†ä»ç„¶é‡å®šå‘ï¼Ÿ**

* è§£å†³ï¼šç”¨ `ping blog.uf4.top` çœ‹æ˜¯å¦æŒ‡å‘ä½ æ–°æœåŠ¡å™¨çš„å…¬ç½‘ IP

---

## âœ… ä¸ƒã€æœ€ç»ˆæµ‹è¯•

è®¿é—®ï¼š

* `http://blog.uf4.top` âœ…
* `https://blog.uf4.top` âœ…ï¼ˆæ¨èç”³è¯·å®å¡” SSLï¼‰

å¦‚æœå¯ç”¨äº†å®å¡”é˜²ç«å¢™æˆ–äº‘å‚å•†å®‰å…¨ç»„ï¼Œè¯·åŠ¡å¿…å¼€æ”¾ï¼š

* `80`ã€`443`ï¼ˆHTTP/HTTPSï¼‰
* `22022`ï¼ˆSSH è¿œç¨‹è¿æ¥ï¼‰

---

## ğŸ§© å…«ã€å»ºè®®å¢å¼º

* è‡ªåŠ¨ç”³è¯·å’Œç»­ç­¾ HTTPSï¼ˆå®å¡”æä¾›ï¼‰
* å®šæ—¶å¤‡ä»½ç½‘ç«™æ–‡ä»¶ + GitHub ä»“åº“
* ä½¿ç”¨ fail2ban é˜² SSH çˆ†ç ´
* é¡µé¢å‹ç¼©å’Œç¼“å­˜è®¾ç½®

---

## ğŸ‰ ä¹ã€æ€»ç»“

ä½ å·²æˆåŠŸå®Œæˆä¸€ä¸ªç°ä»£å‰ç«¯åšå®¢çš„å®Œæ•´éƒ¨ç½²æµç¨‹ï¼Œå…¼é¡¾äº†ï¼š

* è‡ªç”±æ§åˆ¶ï¼ˆéƒ¨ç½²ã€æ—¥å¿—ã€å¤‡ä»½ï¼‰
* è‡ªåŠ¨åŒ–å‘å¸ƒï¼ˆCI/CDï¼‰
* ä½å»¶è¿Ÿä¸å¯æ§ç½‘ç»œï¼ˆä¸ä¾èµ–å›½å¤–æ‰˜ç®¡ï¼‰

æ¬¢è¿å°†æ­¤æµç¨‹è®°å½•åˆ°ä½ çš„åšå®¢ä¸­æˆ–å¤‡ä»½ä»“åº“ã€‚å¦‚éœ€è¿›ä¸€æ­¥ä½¿ç”¨ Dockerã€PM2ã€Nginx Proxy Manager éƒ¨ç½²å¤šç«™ï¼Œæ¬¢è¿ç»§ç»­æ¢ç´¢ï¼

æœ¬æ–‡ä»…ä¾›å­¦ä¹ å‚è€ƒï¼Œè¯·å‹¿ç”¨äºéæ³•ç”¨é€”ã€‚
æœ¬æ–‡å‡ºè‡ªchatgptï¼Œè¯·å‹¿ç”¨äºå•†ä¸šç”¨é€”ã€‚

